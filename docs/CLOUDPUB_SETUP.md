# Настройка CloudPub для локальной разработки

## Что такое CloudPub?

**CloudPub** — российский сервис для создания туннелей к локальным серверам, аналог ngrok. Позволяет получить публичный HTTPS URL для вашего localhost.

**Преимущества:**
- ✅ Серверы в России (низкая задержка)
- ✅ Поддержка HTTPS
- ✅ Простая настройка
- ✅ Бесплатный план доступен

## Быстрая настройка

### Шаг 1: Зарегистрируйтесь на CloudPub

1. Перейдите на [cloudpub.ru](https://cloudpub.ru)
2. Зарегистрируйтесь или войдите в аккаунт
3. Перейдите в личный кабинет

### Шаг 2: Создайте публикацию

1. В личном кабинете нажмите "Создать публикацию" или "Новая публикация"
2. Заполните форму:
   - **Локальный адрес**: `http://localhost:8080`
   - **Протокол**: `HTTP`
   - **Название**: `Mayoku Dev` (опционально)
3. Сохраните публикацию

### Шаг 3: Получите публичный URL

После создания публикации вы получите:
- **Публичный HTTPS URL** (например: `https://abc123.cloudpub.ru`)
- **Токен** (если требуется для клиента)

### Шаг 4: Используйте URL в BotFather

1. Скопируйте HTTPS URL из CloudPub
2. В BotFather при создании Mini App отправьте этот URL
3. BotFather примет URL и создаст Mini App

### Шаг 5: Откройте Mini App

1. Найдите вашего бота `@MayokuBot` в Telegram
2. Откройте меню бота
3. Нажмите на Mini App
4. Mini App откроется через CloudPub туннель

## Пример использования

```bash
# 1. Убедитесь, что приложение запущено
docker compose up -d

# 2. Проверьте, что сервер работает локально
curl http://localhost:8080/health
# Должно вернуть: OK

# 3. В CloudPub создайте публикацию:
#    Локальный адрес: http://localhost:8080
#    Протокол: HTTP

# 4. Скопируйте полученный HTTPS URL (например: https://abc123.cloudpub.ru)

# 5. Проверьте публичный доступ
curl https://abc123.cloudpub.ru/health
# Должно вернуть: OK

# 6. Используйте этот URL в BotFather при создании Mini App
```

## Получение initData

После настройки CloudPub и создания Mini App:

1. Откройте Mini App в Telegram
2. Откройте консоль браузера (F12)
3. Выполните:
```javascript
window.Telegram.WebApp.initData
```
4. Скопируйте полученную строку

Или используйте тестовую страницу `test_initdata.html`:
1. Загрузите `test_initdata.html` на ваш сервер (или через CloudPub)
2. Откройте через Mini App
3. Нажмите "Получить initData"

## Обновление URL

Если нужно изменить URL в BotFather:

1. В BotFather отправьте `/myapps`
2. Выберите ваше приложение
3. Отправьте `/editapp`
4. Выберите "Web App URL"
5. Введите новый CloudPub URL

## Важные замечания

1. **Бесплатный план** может иметь ограничения:
   - Ограничение по трафику
   - Возможно ограничение по времени работы

2. **Безопасность**:
   - CloudPub URL доступен публично
   - Не используйте для продакшена с конфиденциальными данными
   - Для разработки это нормально

3. **Стабильность**:
   - URL может измениться при пересоздании публикации
   - Для постоянного использования рассмотрите платный план

## Альтернатива: Постоянный домен

Для продакшена рекомендуется:
- Использовать собственный домен
- Настроить SSL сертификат (Let's Encrypt)
- Развернуть на VPS или облачном хостинге

## Troubleshooting

### CloudPub не подключается к localhost

1. Убедитесь, что приложение запущено: `docker compose ps`
2. Проверьте локальный доступ: `curl http://localhost:8080/health`
3. В CloudPub укажите правильный порт: `8080`

### BotFather не принимает URL

1. Убедитесь, что URL начинается с `https://`
2. Проверьте, что CloudPub туннель активен
3. Попробуйте открыть URL в браузере - должна открыться ваша страница

### Mini App не открывается

1. Проверьте, что CloudPub публикация активна
2. Убедитесь, что сервер отвечает на запросы
3. Проверьте логи: `docker compose logs app`

